library(dplyr)
library(SportsAnalytics270)
library(ggplot2)
library(dplyr)
data("nba2009_2018")
head(nba2009_2018)
ggplot(nba2009_2018) +
geom_histogram(aes(x = away.PTS), fill= 'red') +
geom_histogram(aes(x = home.PTS), fill= 'blue') +
xlim(c(50,155))
nba = nba2009_2018
nba$diff <- nba$home.PTS - nba$away.PTS
ggplot(nba, aes(x=diff)) + geom_histogram(bins = 50)
nba %>%
filter(SEASON_ID=='2018') %>%
group_by(home.TEAM_ABBREVIATION) %>%
summarise(p_value = shapiro.test(home.PTS)$p.value) %>%
arrange(p_value)
home <- nba %>%
filter(SEASON_ID == '2018') %>%
group_by(home.TEAM_ABBREVIATION) %>%
summarise(mean = mean(home.PTS),
var = var(home.PTS))
View(home)
View(home)
away <- nba %>%
filter(SEASON_ID == '2018') %>%
group_by(away.TEAM_ABBREVIATION) %>%
summarise(mean = mean(away.PTS),
var = var(away.PTS))
View(away)
View(away)
mean <- home$mean[home$home.TEAM_ABBREVIATION=="WAS"] -
away$mean[away$away.TEAM_ABBREVIATION=="DAL"]
sd <- sqrt(home$var[home$home.TEAM_ABBREVIATION == "WAS"] +
away$var[away$away.TEAM_ABBREVIATION])
mean
sd
sd <- sqrt(home$var[home$home.TEAM_ABBREVIATION == "WAS"] +
away$var[away$away.TEAM_ABBREVIATION == "DAL"])
sd
set.seed(1)
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
set.seed(1)
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
ggplot() + geom_histogram(aes(x=diff))
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
set.seed(1)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(10000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
set.seed(1)
diff <- rnorm(10000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(1000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(100000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
set.seed(1)
diff <- rnorm(100000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
diff <- rnorm(10000, mean, sd)
ggplot() + geom_histogram(aes(x=diff))
pnorm(0, mean, sd, lower.tail = T)
pnorm(0, mean, sd, lower.tail = F)
library(dplyr)
library(dplyr)
library(SportsAnalytics270)
data("f_data_sm")
df <- f_data_sm %>% mutate(FTAG = ifelse(FTAG >= 4, "4+", FTAG),
FTHG = ifelse(FTHG >= 4, "4+", FTHG))
View(df)
View(df)
table(Away = df$FTAG, Home = df$FTHG)
df %>% filter(SEASON == 2019) %>% group_by(COUNTRY) %>%
summarise(pvalue = chisq.test(table(FTAG, FTHG)),
simulate.p.value = T)$p.value
df %>% filter(SEASON == 2019) %>% group_by(COUNTRY) %>%
summarise(pvalue = chisq.test(table(FTAG, FTHG),
simulate.p.value = T))
df %>% filter(SEASON == 2019) %>% group_by(COUNTRY) %>%
summarise(pvalue = chisq.test(table(FTAG, FTHG),
simulate.p.value = T))$p.value)
df %>% filter(SEASON == 2019) %>% group_by(COUNTRY) %>%
summarise(pvalue = chisq.test(table(FTAG,FTHG), simulate.p.value = T)$p.value)
df %>% filter(SEASON == 2016) %>% group_by(COUNTRY) %>%
summarise(pvalue = chisq.test(table(FTAG,FTHG), simulate.p.value = T)$p.value)
df %>% filter(SEASON == 2019) %>% group_by(COUNTRY) %>%
summarise(pvalue = chisq.test(table(FTAG,FTHG), simulate.p.value = T)$p.value)
portugal <- f_data_sm %>%
filter(SEASON == 2019, COUNTRY == "Portugal") %>%
select(HOMETEAM, AWAYTEAM, FTHG, FTAG)
View(portugal)
View(portugal)
port1 <- data.frame(portugal[,c("HOMETEAM","AWAYTEAM", "FTHG")], Home = 1)
View(port1)
View(port1)
port2 <- data.frame(portugal[,c("AWAYTEAM","HOMETEAM", "FTAG")], Home = 0)
View(port2)
View(port2)
colnames(port1) <- c("Team", "Opponent", "Goal", "Home")
colnames(port2) <- colnames(port1)
colnames(port1) <- c("Team", "Opponent", "Goal", "Home")
View(port1)
View(port1)
View(port2)
View(port2)
portugal2 <- rbind(port1, port2)
View(portugal2)
View(portugal2)
View(port2)
View(port2)
View(portugal2)
View(portugal2)
View(portugal)
View(portugal)
View(portugal2)
View(portugal2)
model <- glm(Goal-Team+Oponent+Home, data = portugal2, family = poisson(link = log))
model <- glm(Goal~Team+Oponent+Home, data = portugal2, family = poisson(link = log))
model <- glm(Goal~Team+Opponent+Home, data = portugal2, family = poisson(link = log))
coefficients(model)
predict(model, data.frame(Home = 1, Team = "Benfica", Opponent = "Porto"), type = "response")
predict(model, data.frame(Home = 0, Team = "Benfica", Opponent = "Porto"), type = "response")
predict(model, data.frame(Home = 0, Team = "Porto", Opponent = "Benfica"), type = "response")
options(scipen = 1, digits = 4)
predict(model, data.frame(Home = 0, Team = "Porto", Opponent = "Benfica"), type = "response")
predict(model, data.frame(Home = 1, Team = "Benfica", Opponent = "Porto"), type = "response")
predict(model, data.frame(Home = 0, Team = "Porto", Opponent = "Benfica"), type = "response")
options(scipen = 1, digits = 4)
coefficients(model)["(Intercept)"]
coefficients(model)["(TeamBenfica)"]
coefficients(model)
coefficients(model)
coefficients(model)["(TeamBenfica)"]
coefficients(model)["TeamBenfica"]
coefficients(model)["OpponentPorto"]
coefficients(model)["Home"]
coefficients(model)
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
b_a <- exp(-0.0495+1.06-0.8486)
porto_cof <- coefficients(model)["TeamPorto"]
benf_cof <- coefficients(model)["OpponentBenfica"]
b_a <- exp(-0.0495 + porto_cof + benf_cof)
b_a
b_a
b_a
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
b_a <- exp(-0.0495+1.06-0.8486)
b_a
benf_a
benf_a <- exp(-0.0495 + porto_cof + benf_cof)
benf_a
predict(model, data.frame(Home = 0, Team = "Porto", Opponent = "Benfica"), type = "response")
benf_a <- exp(-0.0495 + porto_cof + benf_cof)
benf_a
predict(model, data.frame(Home = 0, Team = "Porto", Opponent = "Benfica"), type = "response")
benf_a <- exp(-0.0495 + porto_cof + benf_cof)
benf_a
predict(model, data.frame(Home = 0, Team = "Benfica", Opponent = "Porto"), type = "response")
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
b_a <- exp(-0.0495+1.06-0.8486)
b_h/b_a
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
b_a <- exp(-0.0495+1.06-0.8486)
b_a <- exp(-0.0495+1.06-0.8486)
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
coefficients(model)["TeamBenfica"]
coefficients(model)["OpponentPorto"]
b_a <- exp(-0.0495+1.06-0.8486)
b_a <- exp(-0.0495+1.06-0.8486)
b_a <- exp(-0.0495+1.06-0.8486)
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
b_h/b_a
b_h <- exp(-0.0495+1.06-0.8486 + 0.2581)
b_a <- exp(-0.0495+1.06-0.8486)
b_home_exp <- b_h/b_a
predict(model, data.frame(Home = 0, Team = "Benfica", Opponent = "Porto"), type = "response")
benf_a <- exp(-0.0495 + porto_cof + benf_cof)
benf_a
porto_cof <- coefficients(model)["TeamPorto"]
benf_cof <- coefficients(model)["OpponentBenfica"]
benf_a <- exp(-0.0495 + porto_cof + benf_cof)
benf_a
k <- rskellam(10000,mu1 = 1.522, mu2 = 1.342)
set.seed(1)
k <- rskellam(10000,mu1 = 1.522, mu2 = 1.342)
library(VGAM)
k <- rskellam(10000,mu1 = 1.522, mu2 = 1.342)
library(ggplot2)
ggplot() + geom_bar(aes(x=k))
sum(dskellam(c(-100:-1),1.522,1.34))
sum(dskellam(0, 1.522, 1.34))
sum(dskellam(c(-100:-1), 1.522, 1.342))
sum(dskellam(c(1:100), 1.522, 1.342))
options(scipen = 1, digits = 4)
intercept <- coefficients(model)["(Intercept)"]
benf_home <- coefficients(model)["TeamBenfica"]
porto_away <- coefficients(model)["OpponentPorto"]
home <- coefficients(model)["Home"]
b_h <- exp(intercept + benf_home + porto_away + home)
b_a <- exp(intercept + benf_home + porto_away)
b_h <- exp(intercept + benf_home + porto_away + home)
b_a <- exp(intercept + benf_home + porto_away)
home <- coefficients(model)["Home"]
porto_home <- coefficients(model)["TeamPorto"]
benf_away <- coefficients(model)["OpponentBenfica"]
porto_home <- coefficients(model)["TeamPorto"]
benf_away <- coefficients(model)["OpponentBenfica"]
p_h <- exp(intercept + porto_home + benf_away + home)
p_a <- exp(intercept + porto_home + benf_away)
predict(model, data.frame(Home = 0, Team = "Benfica", Opponent = "Porto"), type = "response")
predict(model, data.frame(Home = 1, Team = "Benfica", Opponent = "Porto"), type = "response")
predict(model, data.frame(Home = 0, Team = "Porto", Opponent = "Benfica"), type = "response")
intercept <- coefficients(model)["(Intercept)"]
benf_home <- coefficients(model)["TeamBenfica"]
porto_away <- coefficients(model)["OpponentPorto"]
home <- coefficients(model)["Home"]
b_h <- exp(intercept + benf_home + porto_away + home)
b_a <- exp(intercept + benf_home + porto_away)
b_home_exp <- b_h/b_a
p_h <- exp(intercept + porto_home + benf_away + home)
p_h
b_h
p_a
p_home_exp <- p_h / p_a
library(devtools)
install_github("HABET/CSE270")
library(SportsAnalytics270)
data("nba2009_2018")
data("nfl")
head(nfl)
nfl2 <- nfl %>%
select(team_home, team_away, result) %>%
filter(result != "T") %>%
mutate(ht_w = ifelse(result == "H",1,0),
at_w = ifelse(result == "A",1,0))
library(magrittr)
nfl2 <- nfl %>%
select(team_home, team_away, result) %>%
filter(result != "T") %>%
mutate(ht_w = ifelse(result == "H",1,0),
at_w = ifelse(result == "A",1,0))
library(dplyr)
nfl2 <- nfl %>%
select(team_home, team_away, result) %>%
filter(result != "T") %>%
mutate(ht_w = ifelse(result == "H",1,0),
at_w = ifelse(result == "A",1,0))
head(nfl2)
nfl3 <- nfl2 %>%
mutate(team_home = as.factor(team_home),
team_away = as.factor(team_away)) %>%
group_by(team_home, team_away) %>%
summarise(ht=sum(ht_w), at=sum(at_w))
nfl3
View(nfl3)
View(nfl3)
install.packages("BradleyTerry2")
library(BradleyTerry2)
library(BradleyTerry2)
model <- BTm(cbind(ht, at), team_home, team_awat, data = nfl3, id = "team_")
model <- BTm(cbind(ht, at), team_home, team_away, data = nfl3, id = "team_")
coef <- model$coefficients
sort(coef, decreasing = T)
BTabilities(model)
abilities <- as.data.frame(BTabilities(model))
abilities <- as.data.frame(BTabilities(model))
abilities$team <- rownames(abilities)
abilities <- as.data.frame(BTabilities(model))
abilities$team <- rownames(abilities)
abilities <- abilities[order(abilities$ability, decreasing = T),]
abilities
View(abilities)
View(abilities)
library(ggplot2)
abilities %>%
ggplot(aes(x = reorder(team,ability), y = ability)) +
geom_bar(stat = "identity", fill = 1:32) + coord_flip() +
labs(x = "Teams", y = "Ability to Win", title = "Ability to win for NFL teams")
nfl4 <- nfl2 %>%
mutate(team_home = relevel(team_home, ref = "Cleverland Browns"),
team_away = relevel(team_away, ref = "Cleverland Browns")) %>%
group_by(team_home, team_away) %>%
summarise(ht=sum(ht_w), at=sum(at_w))
View(abilities)
View(abilities)
nfl4 <- nfl2 %>%
mutate(team_home = relevel(team_home, ref = "Cleveland Browns"),
team_away = relevel(team_away, ref = "Cleveland Browns")) %>%
group_by(team_home, team_away) %>%
summarise(ht=sum(ht_w), at=sum(at_w))
abilities_brown <- abilities
abilities_brown$ability <- abilities_brown$ability - min(abilities_brown$ability)
head(abilities_brown)
broncos <- data.frame(team_home = rep("Denver Broncos", 4),
team_away = rep("Cleveland Browns", "Tennessee Titans",
"Chicago Bears", "Detroit Lions"))
broncos <- data.frame(team_home = rep("Denver Broncos", 4),
team_away = c("Cleveland Browns", "Tennessee Titans",
"Chicago Bears", "Detroit Lions"))
broncos$team_home <- factor(broncos$team_home,
levels(nfl3$team_home))
broncos$team_away <- factor(broncos$team_away,
levels(nfl3$team_away))
View(broncos)
View(broncos)
levels(broncos$team_home)
broncos <- data.frame(team_home = rep("Denver Broncos", 4),
team_away = c("Cleveland Browns", "Tennessee Titans",
"Chicago Bears", "Detroit Lions"))
View(broncos)
View(broncos)
